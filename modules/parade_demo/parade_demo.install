<?php

/**
 * @file
 * Install hooks for Parade Demo.
 */

/**
 * Implements hook_install().
 */
function parade_demo_install() {
  _parade_demo_create_demo_layout();
  _parade_demo_create_demo_color_schemes();
  _parade_demo_create_demo_content();
}

/**
 * Implements hook_uninstall().
 */
function parade_demo_uninstall() {
  $entityTypeManager = \Drupal::entityTypeManager();

  // Remove content created by this module.
  $nodes = $entityTypeManager
    ->getStorage('node')
    ->loadByProperties(['type' => 'parade_onepage']);

  /** @var \Drupal\node\NodeInterface $node */
  foreach ($nodes as $node) {
    $node->delete();
  }

  /** @var \Drupal\Core\Entity\EntityInterface[] $classyStyles */
  $classyStyles = $entityTypeManager
    ->getStorage('classy_paragraphs_style')
    ->loadMultiple([
      'layout_one_column',
      'layout_two_column_content_1st',
      'layout_two_column_title_1st',
      'layout_text_1st',
      'layout_image_1st',
      'layout_none',
      'layout_rounded_image',
      'layout_separator_clean',
      'layout_text_1st_enhanced',
      'layout_text_with_an_icon',
      'color_clean',
      'color_light_blue',
      'color_light_grey',
      'color_blue',
      'color_shaded',
    ]);

  /** @var \Drupal\Core\Entity\EntityInterface $classyStyle */
  foreach ($classyStyles as $classyStyle) {
    $classyStyle->delete();
  }
}

/**
 * Helper function to create demo layouts.
 */
function _parade_demo_create_demo_layout() {
  $entityTypeManager = \Drupal::entityTypeManager();
  $classyStorage = $entityTypeManager->getStorage('classy_paragraphs_style');

  $layouts = [
    [
      'label' => 'Layout one column',
      'id' => 'layout_one_column',
      'classes' => 'layout--one-column',
    ],
    [
      'label' => 'Layout two column content first',
      'id' => 'layout_two_column_content_1st',
      'classes' => 'layout--two-column-content-1st-inverse',
    ],
    [
      'label' => 'Layout two column title first',
      'id' => 'layout_two_column_title_1st',
      'classes' => 'layout--two-column-title-1st-inverse',
    ],
    [
      'label' => 'Layout text first',
      'id' => 'layout_text_1st',
      'classes' => 'layout--text_1st',
    ],
    [
      'label' => 'Layout image first',
      'id' => 'layout_image_1st',
      'classes' => 'layout--image_1st',
    ],
    [
      'label' => 'Layout none',
      'id' => 'layout_none',
      'classes' => 'layout--none',
    ],
    [
      'label' => 'Layout rounded image',
      'id' => 'layout_rounded_image',
      'classes' => 'layout--rounded_image',
    ],
    [
      'label' => 'Layout separator title only',
      'id' => 'layout_separator_clean',
      'classes' => 'layout--separator-clean',
    ],
    [
      'label' => 'Layout text first - enhanced',
      'id' => 'layout_text_1st_enhanced',
      'classes' => 'layout--text_1st_enhanced',
    ],
    [
      'label' => 'Layout text with an icon',
      'id' => 'layout_text_with_an_icon',
      'classes' => 'layout--text_icon',
    ],
  ];

  foreach ($layouts as $layout) {
    $classyStyle = $classyStorage->create($layout);
    $classyStyle->save();
  }
}

/**
 * Helper function to create demo color schemes.
 */
function _parade_demo_create_demo_color_schemes() {
  $entityTypeManager = \Drupal::entityTypeManager();
  $classyStorage = $entityTypeManager->getStorage('classy_paragraphs_style');

  $layouts = [
    [
      'label' => 'Color clean',
      'id' => 'color_clean',
      'classes' => 'color-clean',
    ],
    [
      'label' => 'Color light blue',
      'id' => 'color_light_blue',
      'classes' => 'color-light-blue',
    ],
    [
      'label' => 'Color light grey',
      'id' => 'color_light_grey',
      'classes' => 'color-light-grey',
    ],
    [
      'label' => 'Color blue',
      'id' => 'color_blue',
      'classes' => 'color-blue',
    ],
    [
      'label' => 'Color shaded',
      'id' => 'color_shaded',
      'classes' => 'color-shaded',
    ],
  ];

  foreach ($layouts as $layout) {
    $classyStyle = $classyStorage->create($layout);
    $classyStyle->save();
  }
}

/**
 * Helper function to create demo content.
 */
function _parade_demo_create_demo_content() {
  $entityTypeManager = \Drupal::entityTypeManager();
  $paragraphStorage = $entityTypeManager->getStorage('paragraph');

  $paradeDemoPath = drupal_get_path('module', 'parade_demo');

  $dirs = [
    'public://paragraphs',
    'public://paragraphs/background',
    'public://image',
    'public://image/box',
    'public://image/' . date('Y-m'),
    'public://image/box' . date('Y-m'),

  ];
  foreach ($dirs as $dir) {
    file_prepare_directory($dir, FILE_CREATE_DIRECTORY);
  }

  $headerBackgroundUri = file_unmanaged_copy($paradeDemoPath . '/images/parade-default-header-video-cut-720p-web.mp4', 'public://paragraphs/background/parade-default-header-video-cut-720p-web.mp4', FILE_EXISTS_REPLACE);
  $headerBackgroundFile = $entityTypeManager->getStorage('file')->create([
    'uri' => $headerBackgroundUri,
  ]);
  $headerBackgroundFile->save();

  $parallaxBackgroundUri = file_unmanaged_copy($paradeDemoPath . '/images/building.jpg', 'public://paragraphs/background/building.jpg', FILE_EXISTS_REPLACE);
  $parallaxBackgroundFile = $entityTypeManager->getStorage('file')->create([
    'uri' => $parallaxBackgroundUri,
  ]);
  $parallaxBackgroundFile->save();

  $imageUri = file_unmanaged_copy($paradeDemoPath . '/images/guitar.jpg', 'public://image/' . date('Y-m') . '/guitar.jpg', FILE_EXISTS_REPLACE);
  $imageFile_1 = $entityTypeManager->getStorage('file')->create([
    'uri' => $imageUri,
  ]);
  $imageFile_1->save();

  $imageUri = file_unmanaged_copy($paradeDemoPath . '/images/hut.jpg', 'public://image/' . date('Y-m') . '/hut.jpg', FILE_EXISTS_REPLACE);
  $imageFile_2 = $entityTypeManager->getStorage('file')->create([
    'uri' => $imageUri,
  ]);
  $imageFile_2->save();

  $imageUri = file_unmanaged_copy($paradeDemoPath . '/images/woman-sample.jpg', 'public://image/' . date('Y-m') . '/woman-sample.jpg', FILE_EXISTS_REPLACE);
  $imageFile_3 = $entityTypeManager->getStorage('file')->create([
    'uri' => $imageUri,
  ]);
  $imageFile_3->save();

  $textImageUri = file_unmanaged_copy($paradeDemoPath . '/images/melbourne.jpg', 'public://image/' . date('Y-m') . '/melbourne.jpg', FILE_EXISTS_REPLACE);
  $textImageFile = $entityTypeManager->getStorage('file')->create([
    'uri' => $textImageUri,
  ]);
  $textImageFile->save();

  $textBoxImageUri = file_unmanaged_copy($paradeDemoPath . '/images/guitar.jpg', 'public://image/box/' . date('Y-m') . '/guitar.jpg', FILE_EXISTS_REPLACE);
  $textBoxImageFile = $entityTypeManager->getStorage('file')->create([
    'uri' => $textBoxImageUri,
  ]);
  $textBoxImageFile->save();

  $defaultIconUri = file_unmanaged_copy($paradeDemoPath . '/images/default-icon.png', 'public://image/box/' . date('Y-m') . '/default-icon.png', FILE_EXISTS_REPLACE);
  $defaultIconFile = $entityTypeManager->getStorage('file')->create([
    'uri' => $defaultIconUri,
  ]);
  $defaultIconFile->save();

  $roundedImageUri = file_unmanaged_copy($paradeDemoPath . '/images/people-sample.jpg', 'public://image/box/' . date('Y-m') . '/people-sample.jpg', FILE_EXISTS_REPLACE);
  $roundedImageFile = $entityTypeManager->getStorage('file')->create([
    'uri' => $roundedImageUri,
  ]);
  $roundedImageFile->save();

  $textImageDrupalUri = file_unmanaged_copy($paradeDemoPath . '/images/drupal-8.png', 'public://image/' . date('Y-m') . '/drupal-8.png', FILE_EXISTS_REPLACE);
  $textImageDrupalFile = $entityTypeManager->getStorage('file')->create([
    'uri' => $textImageDrupalUri,
  ]);
  $textImageDrupalFile->save();

  $textBox = [
    'type' => 'text_box',
    'parade_title' => 'Textbox title',
    'parade_image' => $textBoxImageFile,
    'parade_text' => [
      'value' => "<p>Suspendisse potenti. Curabitur faucibus egestas eros. Donec euismod congue odio. Aliquam sagittis quam quis quam. Maecenas viverra. Donec sapien orci, facilisis quis, sagittis ac, laoreet nec, eros. Quisque sed diam non erat facilisis iaculis.</p>",
      'format' => 'basic_html',
    ],
  ];
  $textBoxParagraphs = [];
  for ($i = 0; $i < 3; $i++) {
    $textBoxParagraphs[] = $paragraphStorage->create($textBox);
  }

  $iconTextBox = [
    'type' => 'text_box',
    'parade_title' => 'Text with an icon',
    'parade_image' => $defaultIconFile,
    'parade_text' => [
      'value' => "<p>Suspendisse potenti. Curabitur faucibus egestas eros. Donec euismod congue odio. Aliquam sagittis quam quis quam. Maecenas viverra. Donec sapien orci, facilisis quis, sagittis ac, laoreet nec, eros. Quisque sed diam non erat facilisis iaculis.</p>",
      'format' => 'basic_html',
    ],
  ];
  $iconParagraphs = [];
  for ($i = 0; $i < 3; $i++) {
    $iconParagraphs[] = $paragraphStorage->create($iconTextBox);
  }

  $roundedTextBox = [
    'type' => 'text_box',
    'parade_title' => 'Rounded image title',
    'parade_image' => $roundedImageFile,
    'parade_text' => [
      'value' => "<p>Suspendisse potenti. Curabitur faucibus egestas eros. Donec euismod congue odio. Aliquam sagittis quam quis quam. Maecenas viverra. Donec sapien orci, facilisis quis, sagittis ac, laoreet nec, eros. Quisque sed diam non erat facilisis iaculis.</p>",
      'format' => 'basic_html',
    ],
  ];
  $roundedParagraphs = [];
  for ($i = 0; $i < 4; $i++) {
    $roundedParagraphs[] = $paragraphStorage->create($roundedTextBox);
  }

  $paragraphsData = [
    [
      'type' => 'header',
      'parade_anchor' => '#home',
      'parade_background' => $headerBackgroundFile,
      'parade_title' => 'Parade',
      'parade_secondary_title' => 'One Page Site Demo no. 1',
      'parade_lead_text' => 'A package built on top of the awesome Paragraphs module, featuring common sections and onepage-site solutions.',
      'parade_call_to_action' => [
        'uri' => 'internal:#builtonparade',
        'title' => 'Drupal project',
      ],
      'parade_enable_parallax' => TRUE,
    ],
    [
      'type' => 'simple',
      'parade_anchor' => '#simpleonecolumn',
      'parade_title' => 'Simple - One column - Clean',
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>

<p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'full_html',
      ],
      'parade_layout' => 'layout_one_column',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'simple',
      'parade_anchor' => '#simple2',
      'parade_title' => 'Simple  - One column - Light Grey',
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'full_html',
      ],
      'parade_layout' => 'layout_one_column',
      'parade_color_scheme' => 'color_light_grey',
    ],
    [
      'type' => 'simple',
      'parade_anchor' => '#simple3',
      'parade_title' => 'Simple - One Column - Shaded',
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>

<p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>

<p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'full_html',
      ],
      'parade_layout' => 'layout_one_column',
      'parade_color_scheme' => 'color_shaded',
    ],
    [
      'type' => 'simple',
      'parade_anchor' => '#simpletwocolumn',
      'parade_title' => 'Simple - Two column - Title first - Inverse',
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'full_html',
      ],
      'parade_layout' => 'layout_two_column_title_1st',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'simple',
      'parade_anchor' => '#simple5',
      'parade_title' => 'Simple - Two column - Content first - inverse',
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia</p>",
        'format' => 'full_html',
      ],
      'parade_layout' => 'layout_two_column_content_1st',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'simple',
      'parade_anchor' => '#simple6',
      'parade_title' => 'Simple - Separator - Title only',
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'full_html',
      ],
      'parade_layout' => 'layout_separator_clean',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'parallax',
      'parade_title' => 'Parallax',
      'parade_anchor' => '#parallax',
      'parade_enable_parallax' => TRUE,
      'parade_minimum_height' => 300,
      'parade_background' => $parallaxBackgroundFile,
      'parade_text' => [
        'value' => "<h2>Parallax Background&nbsp;Image Type</h2>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis n</p>",
        'format' => 'basic_html',
      ],
    ],
    [
      'type' => 'images',
      'parade_title' => 'Images',
      'parade_anchor' => '#images',
      'parade_images' => [
        $imageFile_1,
        $imageFile_2,
        $imageFile_3,
      ],
    ],
    [
      'type' => 'image_text',
      'parade_title' => 'Textbox image first',
      'parade_anchor' => '#imagefirst',
      'parade_image' => $textImageFile,
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'basic_html',
      ],
      'parade_call_to_action' => [
        'uri' => 'internal:#home',
        'title' => 'Home',
      ],
      'parade_layout' => 'layout_image_1st',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'image_text',
      'parade_title' => 'Textbox text first',
      'parade_anchor' => '#textfirst',
      'parade_image' => $textImageFile,
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'basic_html',
      ],
      'parade_call_to_action' => [
        'uri' => 'internal:#home',
        'title' => 'Home',
      ],
      'parade_layout' => 'layout_text_1st',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'image_text',
      'parade_title' => 'Textbox - text first - enhanced',
      'parade_anchor' => '#textfirst-enhanced',
      'parade_image' => $textImageFile,
      'parade_text' => [
        'value' => "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>",
        'format' => 'basic_html',
      ],
      'parade_call_to_action' => [
        'uri' => 'internal:#home',
        'title' => 'Home',
      ],
      'parade_layout' => 'layout_text_1st_enhanced',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'text_boxes',
      'parade_title' => '',
      'parade_anchor' => '#textbox-icons',
      'parade_boxes_per_row' => 3,
      'parade_paragraphs' => $textBoxParagraphs,
      'parade_view_mode' => 'default',
      'parade_layout' => 'layout_text_1st_enhanced',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'text_boxes',
      'parade_title' => 'Text boxes with an icon',
      'parade_anchor' => '#textbox-icons',
      'parade_boxes_per_row' => 3,
      'parade_paragraphs' => $iconParagraphs,
      'parade_view_mode' => 'default',
      'parade_layout' => 'layout_text_1st_enhanced',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'text_boxes',
      'parade_title' => 'Text boxes with rounded image',
      'parade_anchor' => '#textbox-icons',
      'parade_boxes_per_row' => 2,
      'parade_paragraphs' => $roundedParagraphs,
      'parade_view_mode' => 'default',
      'parade_layout' => 'layout_text_1st_enhanced',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'image_text',
      'parade_title' => 'This one page site',
      'parade_anchor' => '#builtonparade',
      'parade_image' => $textImageDrupalFile,
      'parade_text' => [
        'value' => "<p><br />
<strong>is built on <a href=\"https://www.drupal.org/project/parade\">parade module</a>&nbsp;without custom code or CSS.</strong></p>

<p><strong>Brought to you by <a href=\"http://www.brainsum.com\">BRAINSUM</a>.&nbsp;</strong></p>

<p><strong>Powered by <a href=\"https://www.drupal.org/8/\">Drupal 8</a>.</strong></p>",
        'format' => 'basic_html',
      ],
      'parade_layout' => 'layout_text_1st',
      'parade_color_scheme' => 'color_clean',
    ],
    [
      'type' => 'locations',
      'parade_anchor' => '#locations',
      'parade_title' => 'Locations',
      'parade_text' => [
        'value' => "<p>&nbsp;</p>

<p>You can find BRAINSUM offices here.</p>",
        'format' => 'basic_html',
      ],
      'parade_location' => [
        'Budapest, Vámház krt. 7, 1093 Hungary',
        '82108 Bratislava, "Páričkova 1127/18, 821 08 Bratislava, Slovakia',
      ],
    ],
  ];

  $paragraphs = [];
  foreach ($paragraphsData as $data) {
    $paragraphs[] = $paragraphStorage->create($data);
  }

  $demoContent = $entityTypeManager->getStorage('node')->create(
    [
      'type' => 'parade_onepage',
      'title' => 'Parade One Page Site Demo',
      'promote' => FALSE,
      'parade_onepage_id' => 'parade_one_page_site_demo',
      'parade_onepage_menu' => [
        [
          'uri' => 'internal:#home',
          'title' => 'Home',
        ],
        [
          'uri' => 'internal:#simpleonecolumn',
          'title' => 'Simple One Col',
        ],
        [
          'uri' => 'internal:#simpletwocolumn',
          'title' => 'Simple Two Col Title First',
        ],
        [
          'uri' => 'internal:#simple5',
          'title' => 'Simple Two Col Content First',
          'options' => [
            'attributes' => [
              'data-selected' => TRUE,
            ],
          ],
        ],
        [
          'uri' => 'internal:#locations',
          'title' => 'Locations',
        ],
      ],
      'parade_onepage_sections' => $paragraphs,
    ]
  );

  $demoContent->save();
  drupal_set_message('Demo content available at node/' . $demoContent->id(), 'status');
}
