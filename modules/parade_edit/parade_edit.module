<?php

/**
 * @file
 * Code for Parade Edit.
 */

/**
 * Implements hook_preprocess_HOOK().
 *
 * Using hook_preprocess_field().
 * Disable Geysir functionality on node/ID page.
 */
function parade_edit_preprocess_field(&$vars) {
  if (empty($vars['field_type']) || $vars['field_type'] !== 'entity_reference_revisions') {
    return;
  }

  if (isset($vars['attributes']['data-geysir-field-paragraph-field-wrapper'])) {
    $route_match = \Drupal::routeMatch();
    if ($route_match->getRouteName() == 'entity.node.canonical') {
      unset($vars['attributes']['data-geysir-field-paragraph-field-wrapper']);
      $element = &$vars['element'];
      $delta = 0;
      while (!empty($element[$delta])) {
        if (($key = array_search('geysir_field_paragraph_wrapper', $vars['items'][$delta]['content']['#theme_wrappers'])) !== FALSE) {
          unset($vars['items'][$delta]['content']['#theme_wrappers'][$key]);
        }
        unset($vars['items'][$delta]['content']['#geysir_field_paragraph_links']);
        $delta++;
      }
    }
  }
}
